<div class="wrapper">
  <app-navbar></app-navbar>

  <button class="create-msg" mat-fab extended color="primary" (click)="openAddMessageDialog()">
    Create Message
    <mat-icon iconPositionEnd class="add-icon">add</mat-icon>
  </button>

  <div class="spinner-container"  *ngIf="(isLoading$ | async) || (isSubmitting$ | async)">
    <mat-spinner diameter="80"></mat-spinner>
  </div>

  <div class="table-container">
    <!-- Material Table to Display Messages -->
    <mat-table 
      [dataSource]="messages" 
      class="mat-elevation-z8" 
      matSort matSortActive="date" 
      matSortDirection="desc">

      <!-- ID Column -->
      <ng-container matColumnDef="id">
        <mat-header-cell *matHeaderCellDef mat-sort-header>ID</mat-header-cell>
        <mat-cell *matCellDef="let message">{{ message.id }}</mat-cell>
      </ng-container>

      <!-- Name Column -->
      <ng-container matColumnDef="name">
        <mat-header-cell *matHeaderCellDef mat-sort-header>Name</mat-header-cell>
        <mat-cell *matCellDef="let message">{{ message.name }}</mat-cell>
      </ng-container>

      <!-- Message Column (Trimmed to 100 characters) -->
      <ng-container matColumnDef="message">
        <mat-header-cell *matHeaderCellDef mat-sort-header>Message</mat-header-cell>
        <mat-cell *matCellDef="let message">{{ message.message.slice(0, 100) }}</mat-cell>
      </ng-container>

      <!-- Date Column (Formatted) -->
      <ng-container matColumnDef="date">
        <mat-header-cell *matHeaderCellDef mat-sort-header>Date</mat-header-cell>
        <mat-cell *matCellDef="let message">{{ message.date | date:'dd/MM/yyyy HH:mm:ss' }}</mat-cell>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="action">
        <mat-header-cell *matHeaderCellDef>Actions</mat-header-cell>
        <mat-cell *matCellDef="let message">
          <button class="delete-btn" mat-icon-button (click)="openDeleteMessageDialog(message)">
            <mat-icon class="delete-icon">delete</mat-icon>
          </button>
        </mat-cell>
      </ng-container>

      <!-- Define Column Order and MatSort Configuration -->
      <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
      <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
    </mat-table>

    <ng-container *ngIf="!(isLoading$ | async)">
      <h2 class="no-msg" *ngIf="messages.data.length === 0">There's no messages yet</h2>
    </ng-container>

    <mat-paginator 
      (page)="updateRoute($event)" 
      [pageIndex]="paginator.pageIndex" 
      [pageSize]="paginator.pageSize"
      [pageSizeOptions]="[5, 10, 20]" 
      aria-label="Select page">
    </mat-paginator>

  </div>

</div>